#!/bin/sh

# Warna
CYAN="\033[0;36m"
BLUE="\033[1;34m"
NC="\033[0m" # No Color

# Branding
show_branding() {
    echo -e "${CYAN}"
    echo "╔════════════════════════════════════════════╗"
    echo "║        FIRMWARE MODIFICATION PROJECT       ║"
    echo "╚════════════════════════════════════════════╝"
    echo -e "${BLUE}Author: Pakalolo Waraso${NC}"
    echo -e "${BLUE}Special Thanks: Awiks Telegram Group${NC}"
    echo -e "${BLUE}Maintainer: https://github.com/BootLoopLover${NC}"
    echo -e "${CYAN}============================================${NC}"
}

while true; do
    clear
    show_branding
    echo ""
    echo "====== AW1000 Maintenance Menu ======"
    echo "1. Run Htop"
    echo "2. Ookla Speedtest"
    echo "3. Reboot AW1000"
    echo "4. Ping Google.com"
    echo "5. VnStat - Traffic Monitor"
    echo "6. Exit"
    echo "====================================="
    read -p "Select an option [1-6]: " choice

    case "$choice" in
        1)
            if command -v htop >/dev/null 2>&1; then
                htop
            else
                echo "htop not installed. Installing..."
                opkg update && opkg install htop
                htop
            fi
            ;;
                2)
            if ! command -v speedtest >/dev/null 2>&1; then
                echo "Installing Ookla Speedtest CLI..."
                cd /tmp || exit
                wget -O speedtest.tgz https://github.com/BootLoopLover/ookla/raw/main/ookla-speedtest-1.2.0-linux-aarch64.tgz
                tar -xzf speedtest.tgz
                # Check if speedtest binary is there
                if [ -f speedtest ]; then
                    mv speedtest /bin/speedtest
                    chmod +x /bin/speedtest
                else
                    echo "Error: speedtest binary not found after extraction."
                    exit 1
                fi
            fi
            echo "Running Ookla Speedtest..."
            /bin/speedtest
            ;;

        3)
            echo "Rebooting AW1000..."
            reboot
            ;;
        4)
            echo "Pinging google.com..."
            ping -c 5 google.com
            ;;
        5)
            if ! command -v vnstat >/dev/null 2>&1; then
                echo "vnStat not installed. Installing..."
                opkg update && opkg install vnstat
            fi
            echo "Running vnStat..."
            vnstat
            ;;
        6)
            echo "Exiting script. Goodbye!"
            exit 0
            ;;
        *)
            echo "Invalid option. Please choose 1-6."
            ;;
    esac

    echo ""
    read -p "Press [Enter] to return to menu..."
done
