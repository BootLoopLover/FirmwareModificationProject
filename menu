#!/bin/sh

# Warna Terminal
CYAN="\033[0;36m"
BLUE="\033[1;34m"
NC="\033[0m" # No Color

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚              Branding Header               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
show_branding() {
    printf "${CYAN}"
    echo "   ___       __        __     __    "
    echo "  / _ \___ _/ /_____ _/ /__  / /__   "
    echo " / ___/ _ \`/  '_/ _ \`/ / _ \/ / _ \  "
    echo "/_/   \_,_/_/\_\\_,_/_/\___/_/\___/  "
    echo "  / _ \_______    (_)__ ____/ /_     "
    echo " / ___/ __/ _ \  / / -_) __/ __/  _ _ _"
    echo "/_/  /_/  \___/_/ /\__/\__/\__/  (_|_|_)"
    echo "             |___/  Â© Project by Pakalolo"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘     ğŸš€ FIRMWARE MODIFICATION PROJECT ğŸš€    â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    printf "${BLUE}ğŸ‘¤ Author        : Pakalolo Waraso${NC}\n"
    printf "${BLUE}ğŸ’¬ Special Thanks: Awiks Telegram Group${NC}\n"
    printf "${BLUE}ğŸ› ï¸  Maintainer   : https://github.com/BootLoopLover${NC}\n"
    printf "${CYAN}============================================${NC}\n"
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚         Cek Dependensi Dasar Sistem        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
check_dependencies() {
    for cmd in wget tar opkg; do
        if ! command -v "$cmd" >/dev/null 2>&1; then
            echo "âŒ Error: $cmd tidak tersedia. Harap install terlebih dahulu."
            exit 1
        fi
    done
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚              Jalankan htop                 â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
run_htop() {
    if ! command -v htop >/dev/null 2>&1; then
        echo "ğŸ“¦ htop tidak ditemukan. Menginstall..."
        opkg update && opkg install htop || {
            echo "âŒ Gagal menginstall htop."
            return
        }
    fi
    echo "ğŸ–¥ï¸ Menjalankan htop..."
    htop
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚           Jalankan Speedtest               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
run_speedtest() {
    if ! command -v speedtest >/dev/null 2>&1; then
        echo "ğŸ“¦ Menginstall Ookla Speedtest CLI..."
        cd /tmp || return
        wget --no-check-certificate -O speedtest.tgz https://install.speedtest.net/app/cli/ookla-speedtest-1.1.1-linux-aarch64.tgz
        if [ $? -eq 0 ]; then
            tar -xzvf speedtest.tgz -C /usr/bin/ || {
                echo "âŒ Gagal mengekstrak speedtest.tgz ke /usr/bin."
                return
            }
            chmod +x /usr/bin/speedtest
        else
            echo "âŒ Gagal mengunduh speedtest. Periksa koneksi internet."
            return
        fi
    fi

    [ ! -x /usr/bin/speedtest ] && chmod +x /usr/bin/speedtest
    echo "âš¡ Menjalankan Ookla Speedtest..."
    speedtest
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚               Jalankan Ping                â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
run_ping() {
    echo "ğŸ“¡ Melakukan ping ke google.com..."
    ping -c 5 google.com || echo "âŒ Ping gagal. Periksa koneksi internet."
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚              Jalankan vnStat               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
run_vnstat() {
    if ! command -v vnstat >/dev/null 2>&1; then
        echo "ğŸ“¦ vnStat tidak ditemukan. Menginstall..."
        opkg update && opkg install vnstat || {
            echo "âŒ Gagal menginstall vnstat."
            return
        }
    fi
    echo "ğŸ“Š Menjalankan vnStat..."
    vnstat
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚               Menu Utama                   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
main_menu() {
    while true; do
        clear
        show_branding
        echo ""
        echo "======= ğŸ› ï¸ AW1000 Maintenance Menu ğŸ› ï¸ ======="
        echo "1. ğŸ–¥ï¸  CPU Monitor (htop)"
        echo "2. âš¡ Speedtest by Ookla"
        echo "3. ğŸ” Reboot Modem AW1000"
        echo "4. ğŸ“¡ Ping Google.com"
        echo "5. ğŸ“Š Traffic Monitor (vnStat)"
        echo "6. â Exit"
        echo "============================================"
        printf "ğŸ“¥ Pilih opsi [1-6]: "
        read choice

        case "$choice" in
            1) run_htop ;;
            2) run_speedtest ;;
            3)
                if command -v reboot >/dev/null 2>&1; then
                    echo "ğŸ”„ Rebooting Modem AW1000..."
                    reboot
                else
                    echo "âŒ Perintah reboot tidak ditemukan."
                fi
                ;;
            4) run_ping ;;
            5) run_vnstat ;;
            6)
                echo "ğŸ‘‹ Keluar dari skrip. Sampai jumpa!"
                exit 0
                ;;
            *) echo "âš ï¸ Opsi tidak valid. Pilih antara 1-6." ;;
        esac

        echo ""
        printf "ğŸ”™ Tekan [Enter] untuk kembali ke menu..."
        read -r
    done
}

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚              Eksekusi Utama                â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
check_dependencies
main_menu
